(function(){"use strict";var e={5675:function(e,t,o){var l=o(5102),a=o(8029),n=o(4525),s=o.n(n),r=o(1458),i=o(9971),c=o(9797),u=o(4963),d={config:{loadingBar:{color:"deep-orange-9",size:"3px",position:"top"},notify:{position:"bottom-right",progress:!0,color:"teal",icon:"fas fa-info-circle",actions:[{icon:"close",color:"white",round:!0,handler:()=>{}}]}},plugins:{Dialog:r.Z,LoadingBar:i.Z,Notify:c.Z,Cookies:u.Z},iconSet:s()},m=o(9269),p=o(3201);const h=(0,m._)("span",{class:"text-weight-bold"},"RAPO",-1),_=(0,m._)("span",{class:"text-caption text-weight-light"}," Revenue Assurance Process Optimizer ",-1),g={key:1,class:"YL__toolbar-input-container row no-wrap"},f={key:2,class:"text-caption text-weight-light text-teal"},w={key:3,class:"text-caption text-weight-light text-red"},b={class:"q-ma-lg"};function y(e,t,o,l,a,n){const s=(0,m.up)("q-btn"),r=(0,m.up)("q-icon"),i=(0,m.up)("q-toolbar-title"),c=(0,m.up)("q-space"),u=(0,m.up)("q-input"),d=(0,m.up)("q-tooltip"),y=(0,m.up)("q-toolbar"),k=(0,m.up)("q-header"),v=(0,m.up)("q-item-section"),x=(0,m.up)("q-item-label"),q=(0,m.up)("q-item"),C=(0,m.up)("q-list"),V=(0,m.up)("q-scroll-area"),T=(0,m.up)("q-drawer"),D=(0,m.up)("router-view"),W=(0,m.up)("q-page"),S=(0,m.up)("q-page-container"),j=(0,m.up)("q-layout"),U=(0,m.Q2)("ripple");return(0,m.wg)(),(0,m.j4)(j,{view:"hHh Lpr lff",class:"bg-grey-1 rounded-borders"},{default:(0,m.w5)((()=>[(0,m.Wm)(k,{elevated:"",class:"bg-white text-grey-8 q-py-xs","height-hint":"58"},{default:(0,m.w5)((()=>[(0,m.Wm)(y,null,{default:(0,m.w5)((()=>[(0,m.Wm)(s,{flat:"",dense:"",round:"",onClick:n.toggleLeftDrawer,"aria-label":"Menu",icon:"menu"},null,8,["onClick"]),a.$q.screen.gt.xs?((0,m.wg)(),(0,m.j4)(s,{key:0,flat:"","no-caps":"","no-wrap":"",class:"q-ml-xs",to:{name:"controls"}},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{name:"fas fa-poll",color:"teal",size:"40px"}),(0,m.Wm)(i,{shrink:"",class:"column text-left"},{default:(0,m.w5)((()=>[h,_])),_:1})])),_:1})):(0,m.kq)("",!0),(0,m.Wm)(c,{class:"col-1"}),e.hideSearch?(0,m.kq)("",!0):((0,m.wg)(),(0,m.iD)("div",g,[(0,m.Wm)(u,{dense:"",outlined:"",square:"",modelValue:n.search,"onUpdate:modelValue":t[0]||(t[0]=e=>n.search=e),placeholder:"Search",class:"bg-white col",onKeyup:t[1]||(t[1]=t=>e.updateSearch(n.search))},null,8,["modelValue"]),(0,m.Wm)(s,{class:"YL__toolbar-input-btn",color:"grey-3","text-color":"grey-8",icon:"close",unelevated:"",onClick:t[2]||(t[2]=t=>e.updateSearch(""))})])),(0,m.Wm)(c,{class:"col-2"}),e.getTokenIsValid?((0,m.wg)(),(0,m.iD)("span",f,"Connected")):(0,m.kq)("",!0),e.getTokenIsValid?(0,m.kq)("",!0):((0,m.wg)(),(0,m.iD)("span",w,"Disconnected")),e.getTokenIsValid?((0,m.wg)(),(0,m.j4)(s,{key:4,round:"",flat:"",color:"teal",icon:"fas fa-plug fa-rotate-90",onClick:n.disconnect},{default:(0,m.w5)((()=>[(0,m.Wm)(d,null,{default:(0,m.w5)((()=>[(0,m.Uk)("Disconnect")])),_:1})])),_:1},8,["onClick"])):(0,m.kq)("",!0)])),_:1})])),_:1}),e.getTokenIsValid?((0,m.wg)(),(0,m.j4)(T,{key:0,modelValue:a.leftDrawerOpen,"onUpdate:modelValue":t[3]||(t[3]=e=>a.leftDrawerOpen=e),"show-if-above":"",bordered:"",class:"bg-grey-2",width:200,breakpoint:500},{default:(0,m.w5)((()=>[(0,m.Wm)(V,{class:"fit"},{default:(0,m.w5)((()=>[(0,m.Wm)(C,{padding:"",class:"menu-list"},{default:(0,m.w5)((()=>[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(a.menuLinks,(e=>(0,m.wy)(((0,m.wg)(),(0,m.j4)(q,{key:e.text,clickable:"",to:e.route},{default:(0,m.w5)((()=>[(0,m.Wm)(v,{avatar:""},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{color:"grey",name:e.icon},null,8,["name"])])),_:2},1024),(0,m.Wm)(v,null,{default:(0,m.w5)((()=>[(0,m.Wm)(x,null,{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.text),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["to"])),[[U]]))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,m.kq)("",!0),(0,m.Wm)(S,null,{default:(0,m.w5)((()=>[(0,m.Wm)(W,{padding:""},{default:(0,m.w5)((()=>[(0,m._)("div",b,[(0,m.Wm)(D)])])),_:1})])),_:1})])),_:1})}o(4719);var k=o(6957),v=o(5999),x={data(){return{leftDrawerOpen:!1,menuLinks:[{icon:"fas fa-chart-line",text:"Controls",route:"/controls"},{icon:"fas fa-tasks",text:"Results",route:"/results"}],$q:(0,v.Z)()}},methods:{...(0,k.nv)(["updateControlCatalogue","updateSearch","removeToken"]),toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},disconnect(){this.$q.cookies.has("rapo_token")&&this.$q.cookies.remove("rapo_token"),this.removeToken(),this.$router.push("token")}},computed:{...(0,k.Se)(["hideSearch","getSearch","getTokenIsValid"]),search:{get(){return this.getSearch},set(e){return this.updateSearch(e)}}}},q=o(7617),C=o(6384),V=o(7454),T=o(366),D=o(4686),W=o(4633),S=o(8623),j=o(3139),U=o(6931),O=o(4806),Z=o(685),Q=o(6607),$=o(2146),R=o(5246),I=o(2278),L=o(3712),N=o(6974),B=o(8906),A=o(8108),P=o(1410),z=o.n(P);const M=(0,q.Z)(x,[["render",y]]);var E=M;z()(x,"components",{QLayout:C.Z,QHeader:V.Z,QToolbar:T.Z,QBtn:D.Z,QIcon:W.Z,QToolbarTitle:S.Z,QSpace:j.Z,QInput:U.Z,QTooltip:O.Z,QDrawer:Z.Z,QScrollArea:Q.Z,QList:$.Z,QItem:R.Z,QItemSection:I.Z,QItemLabel:L.Z,QPageContainer:N.Z,QPage:B.Z}),z()(x,"directives",{Ripple:A.Z});var Y=o(2201);const H={key:0},F={class:"row items-start q-gutter-lg"};function J(e,t,o,l,a,n){const s=(0,m.up)("q-btn"),r=(0,m.up)("control-box"),i=(0,m.up)("q-page");return(0,m.wg)(),(0,m.j4)(i,null,{default:(0,m.w5)((()=>[(0,m._)("h1",null,[(0,m.Uk)((0,p.zw)(n.filteredControlCatalogueLen)+" Control",1),1!=n.filteredControlCatalogueLen?((0,m.wg)(),(0,m.iD)("span",H,"s")):(0,m.kq)("",!0)]),(0,m.Wm)(s,{class:"q-my-lg",size:"lg",color:"primary",icon:"fas fa-plus",label:"New control",to:{name:"edit-control",params:{controlId:"new"}}}),(0,m._)("div",F,[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(e.filteredControlCatalogue,(t=>((0,m.wg)(),(0,m.j4)(r,{key:t.control_id,control:t,"onControl:deleted":e.updateControlCatalogue},null,8,["control","onControl:deleted"])))),128))])])),_:1})}const K={class:"row items-center no-wrap"},X={class:"col"},G={class:"row items-center justify-start text-h6"},ee={class:"col-auto"},te={class:"row justify-start"},oe={key:0},le={key:0},ae={class:"col-auto"},ne={class:"row justify-start q-pa-sm"};function se(e,t,o,l,a,n){const s=(0,m.up)("q-chip"),r=(0,m.up)("q-item-section"),i=(0,m.up)("q-item"),c=(0,m.up)("run-control-dialog"),u=(0,m.up)("q-separator"),d=(0,m.up)("confirm-dialog"),h=(0,m.up)("q-list"),_=(0,m.up)("q-menu"),g=(0,m.up)("q-btn"),f=(0,m.up)("q-card-section"),w=(0,m.up)("schedule-present-box"),b=(0,m.up)("q-card"),y=(0,m.Q2)("close-popup");return(0,m.wg)(),(0,m.j4)(b,{key:o.control.control_id,class:(0,p.C_)(["my-card q-my-lg column shadow-1 justify-between",{"shadow-3":a.isHovered}]),style:{width:"520px",height:"300px"},onMouseover:t[3]||(t[3]=e=>a.isHovered=!0),onMouseout:t[4]||(t[4]=e=>a.isHovered=!1)},{default:(0,m.w5)((()=>[(0,m.Wm)(f,{class:"col-auto bg-blue-grey-2"},{default:(0,m.w5)((()=>[(0,m._)("div",K,[(0,m._)("div",X,[(0,m._)("div",G,["Y"!==o.control.status?((0,m.wg)(),(0,m.j4)(s,{key:0,"text-color":"white",class:"text-weight-bold bg-red-4"},{default:(0,m.w5)((()=>[(0,m.Uk)(" Inactive ")])),_:1})):(0,m.kq)("",!0),(0,m.Wm)(s,{"text-color":"white",class:"text-weight-bold q-mr-md bg-teal"},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(o.control.control_type),1)])),_:1}),(0,m.Uk)(" "+(0,p.zw)(o.control.control_name),1)])]),(0,m._)("div",ee,[(0,m.Wm)(g,{color:"grey-7",round:"",flat:"",icon:"more_vert"},{default:(0,m.w5)((()=>[(0,m.Wm)(_,null,{default:(0,m.w5)((()=>[(0,m.Wm)(h,{dense:"",class:"text-no-wrap"},{default:(0,m.w5)((()=>[(0,m.Wm)(c,{control:o.control},{default:(0,m.w5)((()=>[(0,m.Wm)(i,{dense:"",clickable:"",class:"col items-center"},{default:(0,m.w5)((()=>[(0,m.Wm)(r,null,{default:(0,m.w5)((()=>[(0,m.Uk)(" Run ")])),_:1})])),_:1})])),_:1},8,["control"]),(0,m.Wm)(u),(0,m.Wm)(i,{clickable:"",to:{name:"edit-control",params:{controlId:o.control.control_id}}},{default:(0,m.w5)((()=>[(0,m.Wm)(r,null,{default:(0,m.w5)((()=>[(0,m.Uk)(" Edit control ")])),_:1})])),_:1},8,["to"]),(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{clickable:"",to:{name:"edit-control",params:{controlId:o.control.control_id},query:{clone:!0}}},{default:(0,m.w5)((()=>[(0,m.Wm)(r,null,{default:(0,m.w5)((()=>[(0,m.Uk)(" Clone control")])),_:1})])),_:1},8,["to"])),[[y]]),(0,m.Wm)(u),(0,m.Wm)(d,{icon:"fas fa-trash-alt",text:"Do you really want to delete this control?",action:n.deleteControl,argument:o.control.control_id},{default:(0,m.w5)((()=>[(0,m.Wm)(i,{dense:"",clickable:""},{default:(0,m.w5)((()=>[(0,m.Wm)(r,null,{default:(0,m.w5)((()=>[(0,m.Uk)(" Delete ")])),_:1})])),_:1})])),_:1},8,["action","argument"])])),_:1})])),_:1})])),_:1})])])])),_:1}),(0,m.Wm)(u),(0,m.Wm)(f,{class:"col"},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(o.control.control_desc),1)])),_:1}),(0,m.Wm)(u),(0,m.Wm)(f,{class:"col-auto q-pa-sm"},{default:(0,m.w5)((()=>[(0,m._)("div",te,[(0,m.Wm)(w,{schedule:o.control.schedule},null,8,["schedule"]),(0,m.Wm)(s,{square:"",color:"blue-grey-7","text-color":"white",icon:"fas fa-history fa-sm"},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(o.control.days_back)+" day",1),o.control.days_back>1?((0,m.wg)(),(0,m.iD)("span",oe,"sÂ ")):(0,m.kq)("",!0),(0,m.Uk)(" back ")])),_:1}),(0,m.Wm)(s,{square:"",color:"blue-grey-7","text-color":"white",icon:"far fa-calendar-alt fa-sm"},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(o.control.days_retention)+" day",1),o.control.days_retention>1?((0,m.wg)(),(0,m.iD)("span",le,"s")):(0,m.kq)("",!0)])),_:1})])])),_:1}),(0,m.Wm)(u),(0,m._)("div",ae,[(0,m._)("div",ne,[o.control.case_config?((0,m.wg)(),(0,m.j4)(s,{key:0,clickable:"",size:"sm",color:"indigo-4","text-color":"white",icon:"fas fa-tag fa-sm",onClick:t[0]||(t[0]=e=>a.$q.notify(o.control.case_config))},{default:(0,m.w5)((()=>[(0,m.Uk)(" Case config ")])),_:1})):(0,m.kq)("",!0),o.control.prerequisite_sql?((0,m.wg)(),(0,m.j4)(s,{key:1,clickable:"",size:"sm",color:"indigo-4","text-color":"white",icon:"fas fa-database fa-sm",onClick:t[1]||(t[1]=e=>a.$q.notify(o.control.prerequisite_sql))},{default:(0,m.w5)((()=>[(0,m.Uk)(" Prerequisite SQL ")])),_:1})):(0,m.kq)("",!0),o.control.preparation_sql?((0,m.wg)(),(0,m.j4)(s,{key:2,clickable:"",size:"sm",color:"indigo-4","text-color":"white",icon:"fas fa-database fa-sm",onClick:t[2]||(t[2]=e=>a.$q.notify(o.control.preparation_sql))},{default:(0,m.w5)((()=>[(0,m.Uk)(" Preparation SQL ")])),_:1})):(0,m.kq)("",!0),"Y"===o.control.with_drop?((0,m.wg)(),(0,m.j4)(s,{key:3,clickable:"",size:"sm",color:"indigo-4","text-color":"white",icon:"fas fa-trash-alt fa-sm"},{default:(0,m.w5)((()=>[(0,m.Uk)(" With Drop ")])),_:1})):(0,m.kq)("",!0),"Y"===o.control.with_deletion?((0,m.wg)(),(0,m.j4)(s,{key:4,clickable:"",size:"sm",color:"indigo-4","text-color":"white",icon:"fas fa-trash-alt fa-sm"},{default:(0,m.w5)((()=>[(0,m.Uk)(" With Delete ")])),_:1})):(0,m.kq)("",!0),"Y"===o.control.need_prerun_hook?((0,m.wg)(),(0,m.j4)(s,{key:5,clickable:"",size:"sm",color:"indigo-4","text-color":"white",icon:"fas fa-bolt fa-sm"},{default:(0,m.w5)((()=>[(0,m.Uk)(" Pre HOOK ")])),_:1})):(0,m.kq)("",!0),"Y"===o.control.need_postrun_hook?((0,m.wg)(),(0,m.j4)(s,{key:6,clickable:"",size:"sm",color:"indigo-4","text-color":"white",icon:"fas fa-bolt fa-sm"},{default:(0,m.w5)((()=>[(0,m.Uk)(" Post HOOK ")])),_:1})):(0,m.kq)("",!0)])]),(0,m.Wm)(u)])),_:1},8,["class"])}const re={class:"row no-wrap items-center"},ie={class:"text-h6 ellipsis"},ce={class:"q-pa-md"},ue={key:0},de={key:1},me={class:"q-gutter-md row items-start"};function pe(e,t,o,l,a,n){const s=(0,m.up)("q-card-section"),r=(0,m.up)("q-date"),i=(0,m.up)("q-toggle"),c=(0,m.up)("q-separator"),u=(0,m.up)("q-btn"),d=(0,m.up)("q-card-actions"),h=(0,m.up)("q-card"),_=(0,m.up)("q-dialog"),g=(0,m.Q2)("close-popup");return(0,m.wg)(),(0,m.iD)(m.HY,null,[(0,m._)("span",{onClick:t[0]||(t[0]=e=>a.visible=!0)},[(0,m.WI)(e.$slots,"default")]),(0,m.Wm)(_,{modelValue:a.visible,"onUpdate:modelValue":t[3]||(t[3]=e=>a.visible=e)},{default:(0,m.w5)((()=>[(0,m.Wm)(h,{class:"column my-card",style:{width:"auto"}},{default:(0,m.w5)((()=>[(0,m.Wm)(s,{class:"col bg-blue-grey-2"},{default:(0,m.w5)((()=>[(0,m._)("div",re,[(0,m._)("div",ie,(0,p.zw)(o.control.control_name),1)])])),_:1}),(0,m.Wm)(s,{class:"column items-center"},{default:(0,m.w5)((()=>[(0,m._)("div",ce,[(0,m.Uk)(" Run for "),a.range?((0,m.wg)(),(0,m.iD)("span",de,"range")):((0,m.wg)(),(0,m.iD)("span",ue,"date")),(0,m.Uk)(": "),(0,m._)("p",null,(0,p.zw)(a.selectDate),1),(0,m._)("div",me,[(0,m.Wm)(r,{modelValue:a.selectDate,"onUpdate:modelValue":t[1]||(t[1]=e=>a.selectDate=e),range:a.range,"today-btn":"",mask:"YYYY-MM-DD",color:"teal",flat:""},null,8,["modelValue","range"])]),(0,m._)("div",null,[(0,m.Wm)(i,{label:"Run for date range",color:"teal","false-value":!1,"true-value":!0,modelValue:a.range,"onUpdate:modelValue":[t[2]||(t[2]=e=>a.range=e),n.rangeChange]},null,8,["modelValue","onUpdate:modelValue"])])])])),_:1}),(0,m.Wm)(c),(0,m.Wm)(d,{align:"right"},{default:(0,m.w5)((()=>[(0,m.wy)((0,m.Wm)(u,{flat:"",color:"primary",label:"Run",icon:"fas fa-play",onClick:n.runControl},null,8,["onClick"]),[[g,-1]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var he={props:["control"],data(){return{visible:!1,range:!1,selectDate:(new Date).toISOString().substring(0,10),$q:(0,v.Z)()}},methods:{rangeChange(){var e=new Date,t=new Date(e.setDate(e.getDate()-2)).toISOString().substring(0,10),o=new Date(e.setDate(e.getDate()-1)).toISOString().substring(0,10);this.range?this.selectDate={from:o,to:t}:this.selectDate=o},runControl(){this.$q.loadingBar.start();var e="";e=this.range?"/api/run-control?name="+this.control.control_name+"&date_from="+this.selectDate.from+"&date_to="+this.selectDate.to:"/api/run-control?name="+this.control.control_name+"&date="+this.selectDate,fetch(e,{method:"POST",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}}).then((e=>{if(e.ok)return this.$q.notify({type:"positive",message:"Control "+this.control.control_name+" queued for execution"}),e.json();this.$q.notify({type:"negative",message:"Control "+this.control.control_name+" failed"})})).then((()=>{this.$q.loadingBar.stop()}))}}},_e=o(9833),ge=o(8055),fe=o(9501),we=o(2397),be=o(6362),ye=o(4492),ke=o(4333),ve=o(8819);const xe=(0,q.Z)(he,[["render",pe]]);var qe=xe;z()(he,"components",{QDialog:_e.Z,QCard:ge.Z,QCardSection:fe.Z,QDate:we.Z,QToggle:be.Z,QSeparator:ye.Z,QCardActions:ke.Z,QBtn:D.Z}),z()(he,"directives",{ClosePopup:ve.Z});const Ce={class:"q-ml-sm"};function Ve(e,t,o,l,a,n){const s=(0,m.up)("q-avatar"),r=(0,m.up)("q-card-section"),i=(0,m.up)("q-btn"),c=(0,m.up)("q-card-actions"),u=(0,m.up)("q-card"),d=(0,m.up)("q-dialog"),h=(0,m.Q2)("close-popup");return(0,m.wg)(),(0,m.iD)(m.HY,null,[(0,m._)("span",{onClick:t[0]||(t[0]=e=>a.visible=!0)},[(0,m.WI)(e.$slots,"default")]),(0,m.Wm)(d,{modelValue:a.visible,"onUpdate:modelValue":t[2]||(t[2]=e=>a.visible=e),persistent:""},{default:(0,m.w5)((()=>[(0,m.Wm)(u,null,{default:(0,m.w5)((()=>[(0,m.Wm)(r,{class:"row items-center"},{default:(0,m.w5)((()=>[(0,m.Wm)(s,{icon:o.icon,color:"primary","text-color":"white"},null,8,["icon"]),(0,m._)("span",Ce,(0,p.zw)(o.text),1)])),_:1}),(0,m.Wm)(c,{align:"right"},{default:(0,m.w5)((()=>[(0,m.wy)((0,m.Wm)(i,{label:"Yes",color:"primary",onClick:t[1]||(t[1]=e=>o.action(o.argument))},null,512),[[h,-1]]),(0,m.wy)((0,m.Wm)(i,{flat:"",label:"No",color:"primary"},null,512),[[h,-1]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var Te={props:["action","argument","icon","text"],data(){return{visible:!1,range:!1,selectDate:(new Date).toISOString().substring(0,10),$q:(0,v.Z)()}},methods:{rangeChange(){var e=new Date,t=new Date(e.setDate(e.getDate()-2)).toISOString().substring(0,10),o=new Date(e.setDate(e.getDate()-1)).toISOString().substring(0,10);this.range?this.selectDate={from:o,to:t}:this.selectDate=o},runControl(){this.$q.loadingBar.start();var e="";e=this.range?"/api/run-control?name="+this.control.control_name+"&date_from="+this.selectDate.from+"&date_to="+this.selectDate.to:"/api/run-control?name="+this.control.control_name+"&date="+this.selectDate,fetch(e,{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>{if(e.ok)return this.$q.notify({type:"positive",message:"Control "+this.control.control_name+" queued for execution"}),e.json();this.$q.notify({type:"negative",message:"Control "+this.control.control_name+" failed"})})).then((e=>{console.log(e),this.$q.loadingBar.stop()}))}}},De=o(9393);const We=(0,q.Z)(Te,[["render",Ve]]);var Se=We;function je(e,t,o,l,a,n){const s=(0,m.up)("q-chip");return(0,m.wg)(),(0,m.j4)(s,{square:"",class:(0,p.C_)(["row items-center",{"bg-blue-grey-4":"D"===n.schedule_type,"bg-blue-grey-5":"W"===n.schedule_type,"bg-blue-grey-6":"M"===n.schedule_type,"bg-blue-grey-7":"X"===n.schedule_type}]),"text-color":"white",icon:"alarm"},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(n.schedule_text),1)])),_:1},8,["class"])}z()(Te,"components",{QDialog:_e.Z,QCard:ge.Z,QCardSection:fe.Z,QAvatar:De.Z,QCardActions:ke.Z,QBtn:D.Z}),z()(Te,"directives",{ClosePopup:ve.Z});var Ue={props:["schedule"],data(){return{schedule_object:{}}},computed:{schedule_type(){return String(this.schedule).indexOf("/")>-1||String(this.schedule).indexOf("-")>-1||(String(this.schedule_object.hour)+String(this.schedule_object.min)+String(this.schedule_object.sec)).indexOf(",")>-1?"X":this.schedule_object.mday?"M":this.schedule_object.wday?"W":"D"},schedule_time(){return String(this.schedule_object.hour).padStart(2,"0")+":"+String(this.schedule_object.min).padStart(2,"0")+":"+String(this.schedule_object.sec).padStart(2,"0")},schedule_text(){var e=[];const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"];if("X"===this.schedule_type)return"Complex ("+this.schedule+")";if("M"===this.schedule_type){for(const t of this.schedule_object.mday)e.push(t);return"Monthly ("+e.join(", ")+") @ "+this.schedule_time}if("W"===this.schedule_type){for(const o of this.schedule_object.wday)e.push(t[o]);return"Weekly ("+e.join(", ")+") @ "+this.schedule_time}return"Daily @ "+this.schedule_time}},mounted(){this.schedule_object=JSON.parse(this.schedule),this.schedule_object.mday&&(this.schedule_object.mday=String(this.schedule_object.mday).split(",").map((e=>Number(e)))),this.schedule_object.wday&&(this.schedule_object.wday=String(this.schedule_object.wday).split(",").map((e=>Number(e))))}},Oe=o(1384);const Ze=(0,q.Z)(Ue,[["render",je]]);var Qe=Ze;z()(Ue,"components",{QChip:Oe.Z});var $e={props:["control"],components:{RunControlDialog:qe,ConfirmDialog:Se,SchedulePresentBox:Qe},data(){return{isHovered:!1,confirmDialog:!1,$q:(0,v.Z)()}},methods:{deleteControl(e){this.$q.loadingBar.start(),this.$router.push({name:"controls"}),fetch("/api/delete-control?control_id="+e,{method:"DELETE",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}}).then((e=>{if(e.ok)return this.$q.notify({type:"positive",message:"Control deleted"}),e.json();this.$q.notify({type:"negative",message:"Unable to delete control"})})).then((()=>{this.$q.loadingBar.stop(),this.$emit("control:deleted",e)}))}}},Re=o(6375);const Ie=(0,q.Z)($e,[["render",se]]);var Le=Ie;z()($e,"components",{QCard:ge.Z,QCardSection:fe.Z,QChip:Oe.Z,QBtn:D.Z,QMenu:Re.Z,QList:$.Z,QItem:R.Z,QItemSection:I.Z,QSeparator:ye.Z}),z()($e,"directives",{ClosePopup:ve.Z});var Ne={components:{ControlBox:Le},methods:{...(0,k.nv)(["updateControlCatalogue"])},computed:{...(0,k.Se)(["filteredControlCatalogue"]),filteredControlCatalogueLen(){return this.filteredControlCatalogue.length}},mounted(){this.updateControlCatalogue()}};const Be=(0,q.Z)(Ne,[["render",J]]);var Ae=Be;z()(Ne,"components",{QPage:B.Z,QBtn:D.Z});const Pe={class:"row q-mx-xl q-mb-xs q-gutter-md"},ze={class:"row q-mx-xl q-mb-md q-gutter-md"},Me={class:"row q-mx-xl q-mb-lg q-gutter-md"},Ee={key:0,class:"row q-mx-xl q-mb-xs q-gutter-md"},Ye={key:1,class:"row q-mx-xl q-mb-md q-gutter-md"},He={class:"row q-mx-xl q-mb-xs q-gutter-md"},Fe={class:"row q-mx-xl q-mb-xs q-gutter-md"},Je={class:"row q-mx-xl q-mb-md q-gutter-md"},Ke={key:0,class:"col"},Xe={class:"col"},Ge={key:2,class:"row q-mx-xl q-mb-md q-gutter-md"},et={key:0,class:"col"},tt={key:1,class:"col"},ot={key:2,class:"col"},lt={key:3,class:"row q-mx-xl q-mb-md q-gutter-md"},at={class:"col"},nt={class:"col"},st={key:4,class:"row q-mx-xl q-mb-md q-gutter-md"},rt={class:"col"},it={key:5,class:"row q-mx-xl q-mb-lg q-gutter-md"},ct={class:"col"},ut={key:6,class:"row q-mx-xl q-mb-lg q-gutter-md"},dt={class:"col"},mt={class:"row q-mx-xl q-mb-md q-gutter-md"},pt={class:"row q-mx-xl q-mb-md q-gutter-md"};function ht(e,t,o,a,n,s){const r=(0,m.up)("q-input"),i=(0,m.up)("q-icon"),c=(0,m.up)("q-item-section"),u=(0,m.up)("q-item"),d=(0,m.up)("q-select"),h=(0,m.up)("sql-box"),_=(0,m.up)("q-toggle"),g=(0,m.up)("schedule-edit-box"),f=(0,m.up)("q-btn"),w=(0,m.up)("q-form"),b=(0,m.up)("q-page");return(0,m.wg)(),(0,m.j4)(b,null,{default:(0,m.w5)((()=>[(0,m._)("div",null,[(0,m._)("h1",null,(0,p.zw)(n.control.control_name?n.control.control_name:"New control"),1),(0,m.Wm)(w,{onSubmit:s.save,onReset:s.cancel},{default:(0,m.w5)((()=>[(0,m._)("div",Pe,[(0,m.Wm)(r,{class:"col",outlined:"",modelValue:n.control.control_name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.control.control_name=e),label:"Control name",rules:[e=>e&&e.length>=3||"Control name should have minimum 3 characters",e=>e&&e.length<=45||"Control name should have maximum 45 characters"],onKeyup:t[1]||(t[1]=e=>n.control&&n.control.control_name&&(n.control.control_name=n.control.control_name.toUpperCase()))},null,8,["modelValue","rules"]),(0,m.Wm)(r,{class:"col",outlined:"",modelValue:n.control.control_alias,"onUpdate:modelValue":t[2]||(t[2]=e=>n.control.control_alias=e),label:"Control alias"},null,8,["modelValue"]),(0,m.Wm)(d,{class:"col-2",outlined:"",modelValue:n.controlVersion,"onUpdate:modelValue":[t[4]||(t[4]=e=>n.controlVersion=e),s.controlVersionChanged],"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Version",options:n.controlVersions,onFilter:s.filterDatasourceList},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-tag",size:"sm",onClick:t[3]||(t[3]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),"no-option":(0,m.w5)((()=>[(0,m.Wm)(u,null,{default:(0,m.w5)((()=>[(0,m.Wm)(c,{class:"text-grey"},{default:(0,m.w5)((()=>[(0,m.Uk)(" No past versions ")])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue"])]),(0,m._)("div",ze,[(0,m.Wm)(r,{class:"col",modelValue:n.control.control_desc,"onUpdate:modelValue":t[5]||(t[5]=e=>n.control.control_desc=e),label:"Control description",outlined:"",autogrow:""},null,8,["modelValue"])]),(0,m._)("div",Me,[(0,m.Wm)(d,{class:"col",outlined:"","emit-value":"","map-options":"",modelValue:n.control.control_type,"onUpdate:modelValue":[t[6]||(t[6]=e=>n.control.control_type=e),s.controlTypeChanged],options:[{label:"Analysis",value:"ANL"},{label:"Reconciliation",value:"REC"}],label:"Control type"},null,8,["modelValue","onUpdate:modelValue"]),(0,m.Wm)(d,{class:"col",outlined:"",readonly:"","emit-value":"","map-options":"",modelValue:n.control.control_engine,"onUpdate:modelValue":t[7]||(t[7]=e=>n.control.control_engine=e),options:[{label:"Database",value:"DB"},{label:"Python",value:"PY"}],label:"Control engine"},null,8,["modelValue"]),(0,m.Wm)(d,{class:"col",outlined:"","emit-value":"","map-options":"",modelValue:n.control.status,"onUpdate:modelValue":t[8]||(t[8]=e=>n.control.status=e),options:[{label:"Active",value:"Y"},{label:"Inactive",value:"N"}],label:"Control status"},null,8,["modelValue"]),(0,m.Wm)(d,{class:"col",outlined:"","emit-value":"","map-options":"",modelValue:n.control.need_postrun_hook,"onUpdate:modelValue":t[9]||(t[9]=e=>n.control.need_postrun_hook=e),options:[{label:"Yes",value:"Y"},{label:"No",value:"N"}],label:"Post-run hook"},null,8,["modelValue"]),(0,m.Wm)(d,{class:"col",outlined:"","emit-value":"","map-options":"",modelValue:n.control.need_prerun_hook,"onUpdate:modelValue":t[10]||(t[10]=e=>n.control.need_prerun_hook=e),options:[{label:"Yes",value:"Y"},{label:"No",value:"N"}],label:"Pre-run hook"},null,8,["modelValue"]),(0,m.Wm)(d,{class:"col",outlined:"","emit-value":"","map-options":"",modelValue:n.withDeleteionDrop,"onUpdate:modelValue":[t[11]||(t[11]=e=>n.withDeleteionDrop=e),s.deletionDropChanged],options:[{label:"No",value:"N"},{label:"Yes, with deletion",value:"deletion"},{label:"Yes, with drop",value:"drop"}],label:"Remove past results"},null,8,["modelValue","onUpdate:modelValue"])]),"ANL"===n.control.control_type?((0,m.wg)(),(0,m.iD)("div",Ee,[(0,m.Wm)(d,{class:"col",outlined:"",modelValue:n.control.source_name,"onUpdate:modelValue":[t[13]||(t[13]=e=>n.control.source_name=e),s.datasourceChanged],"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Datasource",options:n.datasourceListOptions,onFilter:s.filterDatasourceList,rules:[e=>e&&e.length>0||"You must select a datasource"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-table",onClick:t[12]||(t[12]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),"no-option":(0,m.w5)((()=>[(0,m.Wm)(u,null,{default:(0,m.w5)((()=>[(0,m.Wm)(c,{class:"text-grey"},{default:(0,m.w5)((()=>[(0,m.Uk)(" No datasources found ")])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","rules"]),(0,m.Wm)(d,{class:"col-2",outlined:"",modelValue:n.control.source_date_field,"onUpdate:modelValue":t[15]||(t[15]=e=>n.control.source_date_field=e),label:"Date column",options:n.datasourceDateColumns,behavior:"menu",rules:[e=>e&&e.length>0||"No date column to select!"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"far fa-calendar-alt",onClick:t[14]||(t[14]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","options","rules"])])):(0,m.kq)("",!0),"REC"===n.control.control_type?((0,m.wg)(),(0,m.iD)("div",Ye,[(0,m.Wm)(d,{class:"col",outlined:"",modelValue:n.control.source_name_a,"onUpdate:modelValue":[t[17]||(t[17]=e=>n.control.source_name_a=e),s.datasourceAChanged],"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Datasource A",options:n.datasourceListOptions,onFilter:s.filterDatasourceList,rules:[e=>e&&e.length>0||"You must select a datasource"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-table",onClick:t[16]||(t[16]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),"no-option":(0,m.w5)((()=>[(0,m.Wm)(u,null,{default:(0,m.w5)((()=>[(0,m.Wm)(c,{class:"text-grey"},{default:(0,m.w5)((()=>[(0,m.Uk)(" No datasources found ")])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","rules"]),(0,m.Wm)(d,{class:"col-2",outlined:"",modelValue:n.control.source_date_field_a,"onUpdate:modelValue":t[19]||(t[19]=e=>n.control.source_date_field_a=e),label:"Date column A",options:n.datasourceADateColumns,behavior:"menu",rules:[e=>e&&e.length>0||"No date column to select!"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"far fa-calendar-alt",onClick:t[18]||(t[18]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","options","rules"]),(0,m.Wm)(d,{class:"col",outlined:"",modelValue:n.control.source_name_b,"onUpdate:modelValue":[t[21]||(t[21]=e=>n.control.source_name_b=e),s.datasourceBChanged],"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Datasource B",options:n.datasourceListOptions,onFilter:s.filterDatasourceList,rules:[e=>e&&e.length>0||"You must select a datasource"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-table",onClick:t[20]||(t[20]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),"no-option":(0,m.w5)((()=>[(0,m.Wm)(u,null,{default:(0,m.w5)((()=>[(0,m.Wm)(c,{class:"text-grey"},{default:(0,m.w5)((()=>[(0,m.Uk)(" No datasources found ")])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","rules"]),(0,m.Wm)(d,{class:"col-2",outlined:"",modelValue:n.control.source_date_field_b,"onUpdate:modelValue":t[23]||(t[23]=e=>n.control.source_date_field_b=e),label:"Date column B",options:n.datasourceBDateColumns,behavior:"menu",rules:[e=>e&&e.length>0||"No date column to select!"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"far fa-calendar-alt",onClick:t[22]||(t[22]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","options","rules"])])):(0,m.kq)("",!0),(0,m._)("div",He,["ANL"===n.control.control_type?((0,m.wg)(),(0,m.j4)(d,{key:0,class:"col",outlined:"",clearable:"",modelValue:n.control.output_table_columns,"onUpdate:modelValue":t[25]||(t[25]=e=>n.control.output_table_columns=e),multiple:"",options:n.datasourceColumns,"use-chips":"","stack-label":"",label:"Select columns",rules:[e=>e&&e.length>0||"You must select at least one column"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-columns",onClick:t[24]||(t[24]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","options","rules"])):(0,m.kq)("",!0)]),(0,m._)("div",Fe,["REC"===n.control.control_type?((0,m.wg)(),(0,m.j4)(d,{key:0,class:"col",outlined:"",clearable:"",modelValue:n.control.output_table_a_columns,"onUpdate:modelValue":t[27]||(t[27]=e=>n.control.output_table_a_columns=e),multiple:"",options:n.datasourceAColumns,"use-chips":"","stack-label":"",label:"Select columns A",rules:[e=>e&&e.length>0||"You must select at least one column"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-columns",onClick:t[26]||(t[26]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","options","rules"])):(0,m.kq)("",!0),"REC"===n.control.control_type?((0,m.wg)(),(0,m.j4)(d,{key:1,class:"col",outlined:"",clearable:"",modelValue:n.control.output_table_b_columns,"onUpdate:modelValue":t[29]||(t[29]=e=>n.control.output_table_b_columns=e),multiple:"",options:n.datasourceBColumns,"use-chips":"","stack-label":"",label:"Select columns B"},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-columns",onClick:t[28]||(t[28]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","options"])):(0,m.kq)("",!0)]),(0,m._)("div",Je,["REC"===n.control.control_type?((0,m.wg)(),(0,m.iD)("div",Ke,[(0,m.Wm)(h,{label:"Matching criteria (Rule config)",modelValue:n.control.rule_config,"onUpdate:modelValue":t[30]||(t[30]=e=>n.control.rule_config=e)},null,8,["modelValue"])])):(0,m.kq)("",!0),(0,m._)("div",Xe,[(0,m.Wm)(h,{label:"Missmatch criteria (Error config)",modelValue:n.control.error_config,"onUpdate:modelValue":t[31]||(t[31]=e=>n.control.error_config=e)},null,8,["modelValue"])])]),n.inputs.includes("filter")?((0,m.wg)(),(0,m.iD)("div",Ge,["ANL"===n.control.control_type?((0,m.wg)(),(0,m.iD)("div",et,[(0,m.Wm)(h,{label:"Filter",modelValue:n.control.source_filter,"onUpdate:modelValue":t[32]||(t[32]=e=>n.control.source_filter=e)},null,8,["modelValue"])])):(0,m.kq)("",!0),"REC"===n.control.control_type?((0,m.wg)(),(0,m.iD)("div",tt,[(0,m.Wm)(h,{label:"Filter (Datasource A)",modelValue:n.control.source_filter_a,"onUpdate:modelValue":t[33]||(t[33]=e=>n.control.source_filter_a=e)},null,8,["modelValue"])])):(0,m.kq)("",!0),"REC"===n.control.control_type?((0,m.wg)(),(0,m.iD)("div",ot,[(0,m.Wm)(h,{label:"Filter (Datasource B)",modelValue:n.control.source_filter_b,"onUpdate:modelValue":t[34]||(t[34]=e=>n.control.source_filter_b=e)},null,8,["modelValue"])])):(0,m.kq)("",!0)])):(0,m.kq)("",!0),n.inputs.includes("case_config")?((0,m.wg)(),(0,m.iD)("div",lt,[(0,m._)("div",at,[(0,m.Wm)(h,{label:"Case config",modelValue:n.control.case_config,"onUpdate:modelValue":t[35]||(t[35]=e=>n.control.case_config=e)},null,8,["modelValue"])]),(0,m._)("div",nt,[(0,m.Wm)(h,{label:"Result config",modelValue:n.control.result_config,"onUpdate:modelValue":t[36]||(t[36]=e=>n.control.result_config=e)},null,8,["modelValue"])])])):(0,m.kq)("",!0),n.inputs.includes("preparation_sql")?((0,m.wg)(),(0,m.iD)("div",st,[(0,m._)("div",rt,[(0,m.Wm)(h,{label:"Preparation SQL",modelValue:n.control.preparation_sql,"onUpdate:modelValue":t[37]||(t[37]=e=>n.control.preparation_sql=e)},null,8,["modelValue"])])])):(0,m.kq)("",!0),n.inputs.includes("prerequisite_sql")?((0,m.wg)(),(0,m.iD)("div",it,[(0,m._)("div",ct,[(0,m.Wm)(h,{label:"Prerequisite SQL",modelValue:n.control.prerequisite_sql,"onUpdate:modelValue":t[38]||(t[38]=e=>n.control.prerequisite_sql=e)},null,8,["modelValue"])])])):(0,m.kq)("",!0),n.inputs.includes("completion_sql")?((0,m.wg)(),(0,m.iD)("div",ut,[(0,m._)("div",dt,[(0,m.Wm)(h,{label:"Completion SQL",modelValue:n.control.completion_sql,"onUpdate:modelValue":t[39]||(t[39]=e=>n.control.completion_sql=e)},null,8,["modelValue"])])])):(0,m.kq)("",!0),(0,m._)("div",mt,[(0,m.Wm)(_,{color:"blue",label:"Datasource filter",modelValue:n.inputs,"onUpdate:modelValue":t[40]||(t[40]=e=>n.inputs=e),val:"filter"},null,8,["modelValue"]),(0,m.Wm)(_,{color:"blue",label:"Case config",modelValue:n.inputs,"onUpdate:modelValue":t[41]||(t[41]=e=>n.inputs=e),val:"case_config"},null,8,["modelValue"]),(0,m.Wm)(_,{color:"blue",label:"Preparation SQL",modelValue:n.inputs,"onUpdate:modelValue":t[42]||(t[42]=e=>n.inputs=e),val:"preparation_sql"},null,8,["modelValue"]),(0,m.Wm)(_,{color:"blue",label:"Prerequisite SQL",modelValue:n.inputs,"onUpdate:modelValue":t[43]||(t[43]=e=>n.inputs=e),val:"prerequisite_sql"},null,8,["modelValue"]),(0,m.Wm)(_,{color:"blue",label:"Completion SQL",modelValue:n.inputs,"onUpdate:modelValue":t[44]||(t[44]=e=>n.inputs=e),val:"completion_sql"},null,8,["modelValue"])]),(0,m._)("div",pt,[(0,m.Wm)(g,{class:"col",modelValue:n.control.schedule,"onUpdate:modelValue":t[45]||(t[45]=e=>n.control.schedule=e)},null,8,["modelValue"]),(0,m.Wm)(r,{class:"col-auto",modelValue:n.control.days_back,"onUpdate:modelValue":t[47]||(t[47]=e=>n.control.days_back=e),modelModifiers:{number:!0},type:"number",outlined:"",label:"Run days back",rules:[e=>(e||0===e||e<5)&&e>=0||"Not a valid value"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-history",onClick:t[46]||(t[46]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","rules"]),(0,m.Wm)(r,{class:"col-auto",modelValue:n.control.days_retention,"onUpdate:modelValue":t[49]||(t[49]=e=>n.control.days_retention=e),modelModifiers:{number:!0},type:"number",outlined:"",label:"Results retention (days)",rules:[e=>(e||0===e)&&e>=0||"Not a valid value"]},{prepend:(0,m.w5)((()=>[(0,m.Wm)(i,{name:"fas fa-calendar-alt",onClick:t[48]||(t[48]=(0,l.iM)((()=>{}),["stop","prevent"]))})])),_:1},8,["modelValue","rules"])]),(0,m.Wm)(f,{label:"Save",type:"submit",color:"primary"}),(0,m.Wm)(f,{label:"Cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm"})])),_:1},8,["onSubmit","onReset"])])])),_:1})}o(3352);const _t={class:"row items-center justify-between"};function gt(e,t,o,l,a,n){const s=(0,m.up)("q-btn"),r=(0,m.up)("q-item-section"),i=(0,m.up)("q-item"),c=(0,m.up)("q-separator"),u=(0,m.up)("q-list"),d=(0,m.up)("q-menu"),h=(0,m.up)("codemirror"),_=(0,m.Q2)("close-popup");return(0,m.wg)(),(0,m.iD)("div",null,[(0,m._)("span",_t,[(0,m._)("label",null,(0,p.zw)(o.label),1),(0,m._)("div",null,[a.code?((0,m.wg)(),(0,m.j4)(s,{key:0,class:"col-auto",flat:"",size:"xs",icon:"fas fa-times",onClick:n.clearCode},null,8,["onClick"])):(0,m.kq)("",!0),(0,m.Wm)(s,{class:"col-auto",flat:"",size:"sm",label:"Example"},{default:(0,m.w5)((()=>[(0,m.Wm)(d,null,{default:(0,m.w5)((()=>[(0,m.Wm)(u,{dense:"",class:"text-no-wrap"},{default:(0,m.w5)((()=>[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(n.menuItems,(e=>(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{clickable:"",key:e.menuText},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{onClick:t=>n.setCode(e.exampleText)},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.menuText),1)])),_:2},1032,["onClick"])])),_:2},1024)),[[_]]))),128)),a.code?((0,m.wg)(),(0,m.j4)(c,{key:0})):(0,m.kq)("",!0),a.code?(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{key:1,clickable:""},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{onClick:n.clearCode},{default:(0,m.w5)((()=>[(0,m.Uk)(" Clear text ")])),_:1},8,["onClick"])])),_:1})),[[_]]):(0,m.kq)("",!0),(0,m.Wm)(c)])),_:1})])),_:1})])),_:1}),(0,m.kq)("",!0)])]),(0,m.Wm)(h,{ref:"editor",modelValue:a.code,"onUpdate:modelValue":t[0]||(t[0]=e=>a.code=e),"indent-with-tab":!0,"smart-indent":!0,"tab-size":2,extensions:a.extensions,onReady:n.handleReady},null,8,["modelValue","extensions","onReady"])])}var ft=o(3756),wt=o(9876),bt=o(4914),yt={props:["modelValue","label"],emits:["update:modelValue"],components:{Codemirror:ft.Z1},data(){return{view:null,code:this.modelValue,placeholder:this.textPlaceholder,extensions:[(0,bt.i6)(),wt.yy.readOnly.of(!1)],examples:{error_config:[{menuText:"Catch all (as error)",exampleText:"1=1"},{menuText:"ANL Sample conditions (using SQL-like syntax)",exampleText:"(charge != calc_charge or calc_charge is null) and imsi not in (select imsi from ds_imsi_whitelist)"},{menuText:"ANL Sample conditions (using JSON syntax)",exampleText:'[{"column": "CHARGE", "value": "CALC_CHARGE", "is_column": true}, {"connexion": "or", "column": "CALC_CHARGE", "relation": "is", "value": "NULL"}]'},{menuText:"REC Sample conditions (using JSON syntax)",exampleText:'[\n\t{"column_a": "case_type", "column_b": "case_type"}\n]'}],rule_config:[{menuText:"REC Sample conditions (using JSON syntax)",exampleText:'[\n\t{"column_a":"posting_date","column_b":"posting_date"},\n\t{"column_a":"case_type","column_b":"case_type"}\n]'}],case_config:[{menuText:"Basic 3 class example",exampleText:'[\n\t{\n\t\t"case_id": 1,\n\t\t"case_value": "Tariffication confirmed",\n\t\t"case_type": "Normal",\n\t\t"case_description": "Tariffication confirmed."\n\t},\n\t{\n\t\t"case_id": 2,\n\t\t"case_value": "Tariffication failed",\n\t\t"case_type": "Error",\n\t\t"case_description": "Tariffication failed."\n\t},\n\t{\n\t\t"case_id": 3,\n\t\t"case_value": "Tariffication not calculated",\n\t\t"case_type": "Warning",\n\t\t"case_description": "Tariffication not analysed."\n\t}\n]'}],result_config:[{menuText:"Basic 3 class example",exampleText:"case\n\twhen charge = calc_charge then 1\n\twhen charge != calc_charge then 2\n\twhen calc_charge is null then 3\nend"}],source_filter:[{menuText:"Basic filter example",exampleText:"service_id = 1 and direction_id = 1"}],preparation_sql:[{menuText:"Materialized view refresh",exampleText:"begin\n\tdbms_snapshot.refresh('MVIDS_ACTIVE_5G_HLR', 'c');\nend;"},{menuText:"Truncate and insert into table",exampleText:"begin\n\texecute immediate 'truncate table tmp_table';\n\tinsert into tmp_table select subscriber_no, ban, status_date from ds_subscribers where state = trunc(sysdate);\n\tcommit;\nend;"},{menuText:"Insert log line (using vars)",exampleText:"insert into log_sp_run\nvalues ('{control_name} with PID: {process_id} executed', 'COMPLETE', to_date('{control_date:%Y%m%d}', 'yyyymmdd'), sysdate, null, null);"},{menuText:"Complex preparation example (using vars)",exampleText:"declare\n\tcheck_value integer;\nbegin\n\texecute immediate 'select count(*) from user_tables where table_name = ''TMP_{control_name}_{control_date:%Y%m%d}''' into check_value;\n\tif check_value > 0 then\n\t\texecute immediate 'drop table tmp_{control_name}_{control_date:%Y%m%d}';\n\tend if;\n\texecute immediate 'create table tmp_{control_name}_{control_date:%Y%m%d} as ' || 'select * from vids_rr6_pr_sms_dws ' || 'where charged_date >= trunc(sysdate)-7';\nend;"}],prerequisite_sql:[{menuText:"Positive example (control will be executed)",exampleText:"select count(*) from vids_rr7_pr_mms_dws"},{menuText:"Negative example (control execution will be terminated)",exampleText:"select count(*) from vids_rr7_pr_mms_dws\nwhere 1=2"}]}}},computed:{menuItems(){switch(this.label){case"Missmatch criteria (Error config)":return this.examples.error_config;case"Matching criteria (Rule config)":return this.examples.rule_config;case"Case config":return this.examples.case_config;case"Result config":return this.examples.result_config;case"Preparation SQL":return this.examples.preparation_sql;case"Prerequisite SQL":return this.examples.prerequisite_sql;case"Filter":return this.examples.source_filter;case"Filter (Datasource A)":return this.examples.source_filter;case"Filter (Datasource B)":return this.examples.source_filter}return[]}},methods:{handleReady(e){this.view=e.view},printValues(){const e=this.view.state,t=e.selection.ranges;console.log("ranges from",t[0].from),console.log("ranges to",t[0].to)},setCode(e){this.code=e},clearCode(){this.code=""}},watch:{code(e){this.$emit("update:modelValue",e)},modelValue(e){this.code=e}}};const kt=(0,q.Z)(yt,[["render",gt]]);var vt=kt;z()(yt,"components",{QBtn:D.Z,QMenu:Re.Z,QList:$.Z,QItem:R.Z,QItemSection:I.Z,QSeparator:ye.Z}),z()(yt,"directives",{ClosePopup:ve.Z});const xt={class:"row q-gutter-md"},qt={class:"row items-center justify-end"};function Ct(e,t,o,l,a,n){const s=(0,m.up)("q-select"),r=(0,m.up)("q-item-section"),i=(0,m.up)("q-item"),c=(0,m.up)("q-separator"),u=(0,m.up)("q-list"),d=(0,m.up)("q-menu"),h=(0,m.up)("q-btn"),_=(0,m.up)("q-input"),g=(0,m.up)("q-item-label"),f=(0,m.up)("q-toggle"),w=(0,m.up)("q-icon"),b=(0,m.up)("q-time"),y=(0,m.up)("q-popup-proxy"),k=(0,m.Q2)("close-popup");return(0,m.wg)(),(0,m.iD)("div",null,[(0,m._)("div",xt,[(0,m.Wm)(s,{class:"col",outlined:"","emit-value":"","map-options":"",modelValue:a.scheduleType,"onUpdate:modelValue":[t[0]||(t[0]=e=>a.scheduleType=e),n.scheduleTypeChanged],options:[{label:"Daily",value:"D"},{label:"Weekly",value:"W"},{label:"Monthly",value:"M"},{label:"Complex",value:"X"}],label:"Schedule type"},null,8,["modelValue","onUpdate:modelValue"]),"X"===a.scheduleType?((0,m.wg)(),(0,m.j4)(_,{key:0,class:"col",outlined:"",modelValue:a.scheduleObject.mday,"onUpdate:modelValue":t[1]||(t[1]=e=>a.scheduleObject.mday=e),label:"Month"},{append:(0,m.w5)((()=>[(0,m.Wm)(h,{round:"",dense:"",flat:"",icon:"add"},{default:(0,m.w5)((()=>[(0,m.Wm)(d,null,{default:(0,m.w5)((()=>[(0,m.Wm)(u,{dense:"",class:"text-no-wrap"},{default:(0,m.w5)((()=>[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(a.examples.mday,(e=>(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{clickable:"",key:e.menuText},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{onClick:t=>a.scheduleObject.mday=e.exampleText},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.menuText),1)])),_:2},1032,["onClick"])])),_:2},1024)),[[k]]))),128)),(0,m.Wm)(c)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,m.kq)("",!0),"X"===a.scheduleType?((0,m.wg)(),(0,m.j4)(_,{key:1,class:"col",outlined:"",modelValue:a.scheduleObject.wday,"onUpdate:modelValue":t[2]||(t[2]=e=>a.scheduleObject.wday=e),label:"Week"},{append:(0,m.w5)((()=>[(0,m.Wm)(h,{round:"",dense:"",flat:"",icon:"add"},{default:(0,m.w5)((()=>[(0,m.Wm)(d,null,{default:(0,m.w5)((()=>[(0,m.Wm)(u,{dense:"",class:"text-no-wrap"},{default:(0,m.w5)((()=>[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(a.examples.wday,(e=>(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{clickable:"",key:e.menuText},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{onClick:t=>a.scheduleObject.wday=e.exampleText},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.menuText),1)])),_:2},1032,["onClick"])])),_:2},1024)),[[k]]))),128)),(0,m.Wm)(c)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,m.kq)("",!0),"W"==a.scheduleType?((0,m.wg)(),(0,m.j4)(s,{key:2,class:"col",outlined:"","emit-value":"",multiple:"","map-options":"",modelValue:a.scheduleObject.wday,"onUpdate:modelValue":t[3]||(t[3]=e=>a.scheduleObject.wday=e),rules:[e=>e&&e.length>0||"You must select at least one day"],options:[{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6},{label:"Sunday",value:7}],label:"Run on days of week:"},{option:(0,m.w5)((({itemProps:e,opt:t,selected:o,toggleOption:l})=>[(0,m.Wm)(i,(0,p.vs)((0,m.F4)(e)),{default:(0,m.w5)((()=>[(0,m.Wm)(r,null,{default:(0,m.w5)((()=>[(0,m.Wm)(g,{innerHTML:t.label},null,8,["innerHTML"])])),_:2},1024),(0,m.Wm)(r,{side:""},{default:(0,m.w5)((()=>[(0,m.Wm)(f,{"model-value":o,"onUpdate:modelValue":e=>l(t)},null,8,["model-value","onUpdate:modelValue"])])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","rules"])):(0,m.kq)("",!0),"M"==a.scheduleType?((0,m.wg)(),(0,m.j4)(s,{key:3,class:"col",outlined:"","emit-value":"",multiple:"",modelValue:a.scheduleObject.mday,"onUpdate:modelValue":t[4]||(t[4]=e=>a.scheduleObject.mday=e),rules:[e=>e&&e.length>0||"You must select at least one day"],options:[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"10",value:10},{label:"11",value:11},{label:"12",value:12},{label:"13",value:13},{label:"14",value:14},{label:"15",value:15},{label:"16",value:16},{label:"17",value:17},{label:"18",value:18},{label:"19",value:19},{label:"20",value:20},{label:"21",value:21},{label:"22",value:22},{label:"23",value:23},{label:"24",value:24},{label:"25",value:25},{label:"26",value:26},{label:"27",value:27},{label:"28",value:28},{label:"29",value:29},{label:"30",value:30},{label:"31",value:31}],label:"Run on days of month:"},{option:(0,m.w5)((({itemProps:e,opt:t,selected:o,toggleOption:l})=>[(0,m.Wm)(i,(0,p.vs)((0,m.F4)(e)),{default:(0,m.w5)((()=>[(0,m.Wm)(r,null,{default:(0,m.w5)((()=>[(0,m.Wm)(g,{innerHTML:t.label},null,8,["innerHTML"])])),_:2},1024),(0,m.Wm)(r,{side:""},{default:(0,m.w5)((()=>[(0,m.Wm)(f,{"model-value":o,"onUpdate:modelValue":e=>l(t)},null,8,["model-value","onUpdate:modelValue"])])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","rules"])):(0,m.kq)("",!0),(0,m.Wm)(w,{class:"q-mt-lg",name:"fas fa-at",size:"35px",color:"blue-grey-3"}),"X"===a.scheduleType?((0,m.wg)(),(0,m.j4)(_,{key:4,class:"col",outlined:"",modelValue:a.scheduleObject.hour,"onUpdate:modelValue":t[5]||(t[5]=e=>a.scheduleObject.hour=e),rules:[e=>e.length>0||"Must have a value"],label:"Hour"},{append:(0,m.w5)((()=>[(0,m.Wm)(h,{round:"",dense:"",flat:"",icon:"add"},{default:(0,m.w5)((()=>[(0,m.Wm)(d,null,{default:(0,m.w5)((()=>[(0,m.Wm)(u,{dense:"",class:"text-no-wrap"},{default:(0,m.w5)((()=>[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(a.examples.hour,(e=>(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{clickable:"",key:e.menuText},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{onClick:t=>a.scheduleObject.hour=e.exampleText},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.menuText),1)])),_:2},1032,["onClick"])])),_:2},1024)),[[k]]))),128)),(0,m.Wm)(c)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules"])):(0,m.kq)("",!0),"X"===a.scheduleType?((0,m.wg)(),(0,m.j4)(_,{key:5,class:"col",outlined:"",modelValue:a.scheduleObject.min,"onUpdate:modelValue":t[6]||(t[6]=e=>a.scheduleObject.min=e),rules:[e=>e.length>0||"Must have a value"],label:"Minute"},{append:(0,m.w5)((()=>[(0,m.Wm)(h,{round:"",dense:"",flat:"",icon:"add"},{default:(0,m.w5)((()=>[(0,m.Wm)(d,null,{default:(0,m.w5)((()=>[(0,m.Wm)(u,{dense:"",class:"text-no-wrap"},{default:(0,m.w5)((()=>[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(a.examples.min,(e=>(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{clickable:"",key:e.menuText},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{onClick:t=>a.scheduleObject.min=e.exampleText},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.menuText),1)])),_:2},1032,["onClick"])])),_:2},1024)),[[k]]))),128)),(0,m.Wm)(c)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules"])):(0,m.kq)("",!0),"X"===a.scheduleType?((0,m.wg)(),(0,m.j4)(_,{key:6,class:"col",outlined:"",modelValue:a.scheduleObject.sec,"onUpdate:modelValue":t[7]||(t[7]=e=>a.scheduleObject.sec=e),rules:[e=>e.length>0||"Must have a value"],label:"Second"},{append:(0,m.w5)((()=>[(0,m.Wm)(h,{round:"",dense:"",flat:"",icon:"add"},{default:(0,m.w5)((()=>[(0,m.Wm)(d,null,{default:(0,m.w5)((()=>[(0,m.Wm)(u,{dense:"",class:"text-no-wrap"},{default:(0,m.w5)((()=>[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(a.examples.sec,(e=>(0,m.wy)(((0,m.wg)(),(0,m.j4)(i,{clickable:"",key:e.menuText},{default:(0,m.w5)((()=>[(0,m.Wm)(r,{onClick:t=>a.scheduleObject.sec=e.exampleText},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.menuText),1)])),_:2},1032,["onClick"])])),_:2},1024)),[[k]]))),128)),(0,m.Wm)(c)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules"])):(0,m.kq)("",!0),"X"!==a.scheduleType?((0,m.wg)(),(0,m.j4)(_,{key:7,class:"col",outlined:"",modelValue:a.scheduleTimepicker,"onUpdate:modelValue":[t[9]||(t[9]=e=>a.scheduleTimepicker=e),n.scheduleDateTimeChanged],mask:"fulltime"},{append:(0,m.w5)((()=>[(0,m.Wm)(w,{name:"access_time",class:"cursor-pointer"},{default:(0,m.w5)((()=>[(0,m.Wm)(y,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,m.w5)((()=>[(0,m.Wm)(b,{modelValue:a.scheduleTimepicker,"onUpdate:modelValue":t[8]||(t[8]=e=>a.scheduleTimepicker=e),"with-seconds":"",format24h:"",color:"teal"},{default:(0,m.w5)((()=>[(0,m._)("div",qt,[(0,m.wy)((0,m.Wm)(h,{label:"Save",color:"teal",flat:"",onClick:n.scheduleDateTimeChanged},null,8,["onClick"]),[[k]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","onUpdate:modelValue"])):(0,m.kq)("",!0)])])}var Vt={props:["modelValue"],emits:["update:modelValue"],data(){return{schedule:this.modelValue,scheduleObject:{},scheduleType:null,scheduleTimepicker:null,examples:{mday:[{menuText:"First day of the month",exampleText:"1"},{menuText:"First 3 days of the month",exampleText:"1-3"},{menuText:"Repeat every third day",exampleText:"/3"},{menuText:"Clear value (run every day of the month)",exampleText:""}],wday:[{menuText:"On Monday",exampleText:"1"},{menuText:"On Monday and Friday",exampleText:"1,5"},{menuText:"Between Monday and Friday",exampleText:"1-5"},{menuText:"Clear value (run every day of week)",exampleText:""}],hour:[{menuText:"At 8 o'clock in the morning",exampleText:"8"},{menuText:"At 8 and 15 o'clock",exampleText:"8,15"},{menuText:"Between 8 and 17 o'clock",exampleText:"8-17"},{menuText:"Run every hour",exampleText:"/1"},{menuText:"Every six hours",exampleText:"/6"}],min:[{menuText:"On the full hour",exampleText:"0"},{menuText:"Every 15 minutes",exampleText:"/15"}],sec:[{menuText:"On the full minute",exampleText:"0"},{menuText:"Every 30 seconds",exampleText:"/30"}]}}},methods:{scheduleTypeChanged(){this.scheduleObject.mday=null,this.scheduleObject.wday=null,"X"===this.scheduleType&&(this.scheduleObject.hour="8",this.scheduleObject.min="15",this.scheduleObject.sec="0",this.scheduleTimepicker="08:15:00")},scheduleDateTimeChanged(){const e=this.scheduleTimepicker.split(":");this.scheduleObject.hour=Number(e[0]),this.scheduleObject.min=Number(e[1]),this.scheduleObject.sec=Number(e[2])},toScheduleObject(e){var t={mday:null,wday:null,hour:"8",min:"15",sec:"0"};return e&&(t=JSON.parse(e),String(e).indexOf("/")>-1||String(e).indexOf("-")>-1||String(t.mday).indexOf(",")>-1&&String(t.wday).indexOf(",")>-1||(String(t.hour)+String(t.min)+String(t.sec)).indexOf(",")>-1?this.scheduleType="X":t.mday?this.scheduleType="M":t.wday?this.scheduleType="W":this.scheduleType="D","X"!==this.scheduleType&&(t.mday&&(t.mday=String(t.mday).split(",").map((e=>Number(e)))),t.wday&&(t.wday=String(t.wday).split(",").map((e=>Number(e)))))),this.scheduleTimepicker||(this.scheduleTimepicker=String(t.hour).padStart(2,"0")+":"+String(t.min).padStart(2,"0")+":"+String(t.sec).padStart(2,"0")),t},toScheduleString(e){var t={mday:e.mday?String(e.mday):null,wday:e.wday?String(e.wday):null,hour:String(e.hour),min:String(e.min),sec:String(e.sec)};return JSON.stringify(t)}},watch:{schedule(e){this.$emit("update:modelValue",e)},modelValue(e){this.scheduleObject=this.toScheduleObject(e)},scheduleObject:{deep:!0,handler(e){this.schedule=this.toScheduleString(e)}}}},Tt=o(3581),Dt=o(9778),Wt=o(9885);const St=(0,q.Z)(Vt,[["render",Ct]]);var jt=St;z()(Vt,"components",{QSelect:Tt.Z,QInput:U.Z,QBtn:D.Z,QMenu:Re.Z,QList:$.Z,QItem:R.Z,QItemSection:I.Z,QSeparator:ye.Z,QItemLabel:L.Z,QToggle:be.Z,QIcon:W.Z,QPopupProxy:Dt.Z,QTime:Wt.Z}),z()(Vt,"directives",{ClosePopup:ve.Z});var Ut={components:{SqlBox:vt,ScheduleEditBox:jt},props:{controlId:{type:String,default:"new"}},data(){return{control:{},controlVersions:[],controlVersion:"ACTUAL",datasourceColumns:null,datasourceDateColumns:null,datasourceAColumns:null,datasourceADateColumns:null,datasourceBColumns:null,datasourceBDateColumns:null,datasourceList:null,datasourceListOptions:null,datasourceListAOptions:null,datasourceListBOptions:null,withDeleteionDrop:"N",inputs:[],$q:(0,v.Z)()}},computed:{...(0,k.Se)(["controlCatalogueById"])},methods:{filterDatasourceList(e,t,o){e.length<0?o():t((()=>{const t=e.toLowerCase();this.datasourceListOptions=this.datasourceList.filter((e=>e.toLowerCase().indexOf(t)>-1))}))},getDatasources(){this.$q.loadingBar.start(),fetch("/api/get-datasources",{method:"GET",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}}).then((e=>{if(e.ok)return e.json()})).then((e=>{this.datasourceList=e,this.$q.loadingBar.stop()}))},async getDatasourceColumns(e){const t=await fetch("/api/get-datasource-columns?datasource_name="+e,{method:"GET",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();return e}},async getDatasourceDateColumns(e){const t=await fetch("/api/get-datasource-date-columns?datasource_name="+e,{method:"GET",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();return e}},controlTypeChanged(){this.control.source_name="",this.control.source_name_a="",this.control.source_name_b="",this.control.source_filter="",this.control.source_filter_a="",this.control.source_filter_b="",this.control.source_date_field="",this.control.source_date_field_a="",this.control.source_date_field_b="",this.control.output_table_columns=[],this.control.output_table_a_columns=[],this.control.output_table_b_columns=[]},datasourceChanged(e){this.control.source_filter="",this.getDatasourceColumns(e).then((e=>{this.datasourceColumns=e,this.control.output_table_columns=e})),this.getDatasourceDateColumns(e).then((e=>{this.datasourceDateColumns=e,this.control.source_date_field=e[0]}))},datasourceAChanged(e){this.control.source_filter_a="",this.getDatasourceColumns(e).then((e=>{this.datasourceAColumns=e,this.control.output_table_a_columns=e})),this.getDatasourceDateColumns(e).then((e=>{this.datasourceADateColumns=e,this.control.source_date_field_a=e[0]}))},datasourceBChanged(e){this.control.source_filter_b="",this.getDatasourceColumns(e).then((e=>{this.datasourceBColumns=e,this.control.output_table_b_columns=e})),this.getDatasourceDateColumns(e).then((e=>{this.datasourceBDateColumns=e,this.control.source_date_field_b=e[0]}))},async getControlVersions(e){const t=await fetch("/api/get-control-versions?control_id="+e,{method:"GET",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();this.controlVersions=e,this.controlVersions.forEach((e=>{e.label=new Date(e.audit_date).toISOString("de-DE").substring(0,19).replace("T"," ")})),this.control.label="ACTUAL",this.controlVersions.unshift(this.control)}},controlVersionChanged(){this.control=this.controlVersion;try{"ANL"===this.control.control_type?(this.control.output_table_columns=JSON.parse(this.control["output_table"]).columns,this.getDatasourceColumns(this.control.source_name).then((e=>this.datasourceColumns=e))):(this.control.output_table_a_columns=JSON.parse(this.control["output_table_a"]).columns,this.getDatasourceColumns(this.control.source_name_a).then((e=>this.datasourceAColumns=e)),this.control.output_table_b_columns=JSON.parse(this.control["output_table_b"]).columns,this.getDatasourceColumns(this.control.source_name_b).then((e=>this.datasourceBColumns=e)))}catch(e){console.log(e)}(this.control.source_filter||this.control.source_filter_a||this.control.source_filter_b)&&this.inputs.push("filter"),(this.control.case_config||this.control.result_config)&&this.inputs.push("case_config"),this.control.preparation_sql&&this.inputs.push("preparation_sql"),this.control.prerequisite_sql&&this.inputs.push("prerequisite_sql"),this.control.completion_sql&&this.inputs.push("completion_sql"),this.withDeleteionDrop="Y"===this.control.with_drop?"drop":"Y"===this.control.with_deletion?"deletion":"N"},deletionDropChanged(){"N"===this.withDeleteionDrop?(this.control.with_deletion="N",this.control.with_drop="N"):"deletion"===this.withDeleteionDrop?(this.control.with_deletion="Y",this.control.with_drop="N"):"drop"===this.withDeleteionDrop&&(this.control.with_deletion="N",this.control.with_drop="Y")},save(){if(this.control.output_table_columns&&this.control.output_table_columns.length?this.control.output_table=JSON.stringify({columns:this.control.output_table_columns}):(this.control.output_table_a=JSON.stringify({columns:this.control.output_table_a_columns}),this.control.output_table_b=JSON.stringify({columns:this.control.output_table_b_columns})),"REC"===this.control.control_type){if(this.control.control_subtype="MA",this.control.output_table=[],this.control.output_table_a_columns)for(const e of this.control.output_table_a_columns)this.control.output_table.push({column_a:e});if(this.control.output_table_b_columns)for(const e of this.control.output_table_b_columns)this.control.output_table.push({column_b:e});this.control.output_table=JSON.stringify({columns:this.control.output_table})}fetch("/api/save-control",{method:"POST",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"},body:JSON.stringify(this.control)}).then((e=>(e.ok||(this.$q.notify({type:"warning",message:"Network response was not ok: "+e}),this.$router.push({name:"controls"})),e.json()))).then((e=>{this.$q.notify({type:"positive",message:"Control: "+this.control.control_name+" was saved successfully."}),this.$router.push({name:"controls"})})).catch((e=>{this.$q.notify({type:"negative",message:"Error:"+e}),this.$router.push({name:"controls"})}))},cancel(){this.$q.notify({type:"warning",message:"Changes discarded"}),this.$router.push({name:"controls"})}},watch:{inputs(){this.inputs.includes("filter")||(this.control.source_filter="",this.control.source_filter_a="",this.control.source_filter_b=""),this.inputs.includes("case_config")||(this.control.case_config="",this.control.result_config=""),this.inputs.includes("preparation_sql")||(this.control.preparation_sql=""),this.inputs.includes("prerequisite_sql")||(this.control.prerequisite_sql=""),this.inputs.includes("completion_sql")||(this.control.completion_sql="")}},mounted(){this.getDatasources();const e=this.controlCatalogueById(this.controlId);if(e){this.control=e,this.getControlVersions(this.controlId),this.$route.query.clone&&(delete this.control.control_id,this.control.control_name=this.control.control_name+"_CLONE");try{"ANL"===this.control.control_type?(this.control.output_table_columns=JSON.parse(this.control["output_table"]).columns,this.getDatasourceColumns(this.control.source_name).then((e=>this.datasourceColumns=e))):(this.control.output_table_a_columns=JSON.parse(this.control["output_table_a"]).columns,this.getDatasourceColumns(this.control.source_name_a).then((e=>this.datasourceAColumns=e)),this.control.output_table_b_columns=JSON.parse(this.control["output_table_b"]).columns,this.getDatasourceColumns(this.control.source_name_b).then((e=>this.datasourceBColumns=e)))}catch(t){console.log(t)}(this.control.source_filter||this.control.source_filter_a||this.control.source_filter_b)&&this.inputs.push("filter"),(this.control.case_config||this.control.result_config)&&this.inputs.push("case_config"),this.control.preparation_sql&&this.inputs.push("preparation_sql"),this.control.prerequisite_sql&&this.inputs.push("prerequisite_sql"),this.control.completion_sql&&this.inputs.push("completion_sql"),this.withDeleteionDrop="Y"===this.control.with_drop?"drop":"Y"===this.control.with_deletion?"deletion":"N"}else this.control={control_engine:"DB",control_type:"ANL",status:"Y",need_hook:"Y",need_postrun_hook:"Y",need_prerun_hook:"N",with_deletion:"N",with_drop:"N",days_back:1,days_retention:90,schedule:""}}},Ot=o(3276);const Zt=(0,q.Z)(Ut,[["render",ht]]);var Qt=Zt;z()(Ut,"components",{QPage:B.Z,QForm:Ot.Z,QInput:U.Z,QSelect:Tt.Z,QIcon:W.Z,QItem:R.Z,QItemSection:I.Z,QToggle:be.Z,QBtn:D.Z});const $t=e=>((0,m.dD)("data-v-7cfeb776"),e=e(),(0,m.Cn)(),e),Rt={key:0},It={class:"q-pa-md"},Lt=$t((()=>(0,m._)("thead",null,[(0,m._)("tr",{class:"bg-blue-grey-2"},[(0,m._)("th",{class:"text-left"},"Run timestamp"),(0,m._)("th",{class:"text-center"},"Run duration"),(0,m._)("th",{class:"text-left"},"PID"),(0,m._)("th",{class:"text-left"},"Processname"),(0,m._)("th",{class:"text-left"},"Run from"),(0,m._)("th",{class:"text-left"},"Run to"),(0,m._)("th",{class:"text-right"},"Fetched A"),(0,m._)("th",{class:"text-right"},"Fetched B"),(0,m._)("th",{class:"text-right"},"Discr. A"),(0,m._)("th",{class:"text-right"},"Discr. B"),(0,m._)("th",{class:"text-right"},"Err. lvl A [%]"),(0,m._)("th",{class:"text-right"},"Err. lvl B [%]"),(0,m._)("th",{class:"text-right"},"Prerequisite"),(0,m._)("th",{class:"text-left"},"Status")])],-1))),Nt={class:"text-left"},Bt={class:"text-center"},At={class:"text-left text-weight-bold text-blue-grey-7"},Pt={class:"text-left text-weight-bold text-teal"},zt={class:"text-left"},Mt={class:"text-left"},Et={class:"text-right"},Yt={class:"text-right"},Ht={class:"text-right"},Ft={class:"text-right"},Jt={class:"text-right text-red"},Kt={class:"text-right text-red"},Xt={class:"text-right"},Gt={class:"text-left"};function eo(e,t,o,l,a,n){const s=(0,m.up)("router-link"),r=(0,m.up)("q-avatar"),i=(0,m.up)("q-chip"),c=(0,m.up)("q-markup-table"),u=(0,m.up)("q-page");return(0,m.wg)(),(0,m.j4)(u,null,{default:(0,m.w5)((()=>[(0,m._)("h1",null,[(0,m.Uk)((0,p.zw)(n.filteredControlResultsLen)+" Control result",1),1!=n.filteredControlResultsLen?((0,m.wg)(),(0,m.iD)("span",Rt,"s")):(0,m.kq)("",!0)]),(0,m._)("div",It,[(0,m.Wm)(c,{dense:"true"},{default:(0,m.w5)((()=>[Lt,(0,m._)("tbody",null,[((0,m.wg)(!0),(0,m.iD)(m.HY,null,(0,m.Ko)(e.filteredControlResults,(e=>((0,m.wg)(),(0,m.iD)("tr",{key:e.process_id},[(0,m._)("td",Nt,[(0,m._)("strong",null,(0,p.zw)(n.toDateTimeString(e.start_date)),1)]),(0,m._)("td",Bt,(0,p.zw)(n.round(e.duration_minutes,2))+" min",1),(0,m._)("td",At,(0,p.zw)(e.process_id),1),(0,m._)("td",Pt,[(0,m.Wm)(s,{to:{name:"edit-control",params:{controlId:e.control_id}}},{default:(0,m.w5)((()=>[(0,m.Uk)((0,p.zw)(e.control_name),1)])),_:2},1032,["to"])]),(0,m._)("td",zt,(0,p.zw)(n.toDateString(e.date_from)),1),(0,m._)("td",Mt,(0,p.zw)(n.toDateString(e.date_to)),1),(0,m._)("td",Et,(0,p.zw)(e.fetched_a),1),(0,m._)("td",Yt,(0,p.zw)(e.fetched_b),1),(0,m._)("td",Ht,(0,p.zw)(e.errors_a),1),(0,m._)("td",Ft,(0,p.zw)(e.errors_b),1),(0,m._)("td",Jt,(0,p.zw)(n.round(e.error_level_a,2))+"%",1),(0,m._)("td",Kt,(0,p.zw)(n.round(e.error_level_b,2))+"%",1),(0,m._)("td",Xt,(0,p.zw)(e.prerequisite_value),1),(0,m._)("td",Gt,[(0,m.Wm)(i,{class:"cursor-pointer"},{default:(0,m.w5)((()=>["Error"==e.status?((0,m.wg)(),(0,m.j4)(r,{key:0,icon:"fas fa-exclamation-circle",color:"deep-orange","text-color":"white",onClick:t=>n.showErrorDialog(e)},null,8,["onClick"])):(0,m.kq)("",!0),"Running"==e.status?((0,m.wg)(),(0,m.j4)(r,{key:1,icon:"fas fa-sync fa-spin",color:"blue","text-color":"white",onClick:t=>n.showCancelDialog(e)},null,8,["onClick"])):(0,m.kq)("",!0),"Success"==e.status?((0,m.wg)(),(0,m.j4)(r,{key:2,icon:"fas fa-check-circle",color:"green","text-color":"white",onClick:t=>n.showRevokeDialog(e)},null,8,["onClick"])):(0,m.kq)("",!0),"Initiated"==e.status?((0,m.wg)(),(0,m.j4)(r,{key:3,icon:"fas fa-play-circle",color:"blue","text-color":"white"})):(0,m.kq)("",!0),"Revoked"==e.status?((0,m.wg)(),(0,m.j4)(r,{key:4,icon:"fas fa-minus-circle",color:"grey","text-color":"white"})):(0,m.kq)("",!0),"Canceled"==e.status?((0,m.wg)(),(0,m.j4)(r,{key:5,icon:"fas fa-times-circle",color:"purple-3","text-color":"white"})):(0,m.kq)("",!0),(0,m.Uk)(" "+(0,p.zw)(e.status),1)])),_:2},1024)])])))),128))])])),_:1})])])),_:1})}var to={data(){return{$q:(0,v.Z)(),pagination:{rowsPerPage:0},refreshTimer:null}},methods:{...(0,k.nv)(["updateControlResults"]),toDateString(e){var t=new Date(e).toISOString("de-DE").substring(0,10);return t},toDateTimeString(e){var t=new Date(e).toISOString("de-DE").substring(0,19).replace("T"," ");return t},round(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},showErrorDialog(e){this.$q.dialog({title:e.control_name,message:e.text_error})},showCancelDialog(e){this.$q.dialog({title:e.control_name,message:"Do you really want to stop the execution of this control?",cancel:!0,persistent:!0}).onOk((()=>{fetch("/api/cancel-control?id="+e.process_id,{method:"POST",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}}).then((t=>{t.ok?(this.$q.notify({type:"positive",message:"Control run '"+e.control_name+" PID:"+e.process_id+"' was canceled"}),e.status="Canceled"):this.$q.notify({type:"negative",message:"Stopping control run '"+e.control_name+" PID:"+e.process_id+"' failed"})})).then((()=>{this.$q.loadingBar.stop()}))})).onCancel((()=>{this.$q.notify({message:"No action taken"})}))},showRevokeDialog(e){this.$q.dialog({title:e.control_name,message:"Do you really want to revoke this control run?",cancel:!0,persistent:!0}).onOk((()=>{fetch("/api/revoke-control-run?id="+e.process_id,{method:"DELETE",headers:{Authorization:`Bearer ${this.$store.getters.getToken}`,"Content-Type":"application/json"}}).then((t=>{t.ok?(this.$q.notify({type:"positive",message:"Control run '"+e.control_name+" PID:"+e.process_id+"' was revoked"}),e.status="Revoked"):this.$q.notify({type:"negative",message:"Revoke of control run '"+e.control_name+" PID:"+e.process_id+"' failed"})})).then((()=>{this.$q.loadingBar.stop()}))})).onCancel((()=>{this.$q.notify({message:"No action taken"})}))},startRefreshTimer(){this.refreshTimer=setInterval(this.updateControlResults,1e4)},stopRefreshTimer(){clearInterval(this.refreshTimer)}},computed:{...(0,k.Se)(["filteredControlResults"]),filteredControlResultsLen(){return this.filteredControlResults.length}},mounted(){this.updateControlResults(),this.startRefreshTimer()},unmounted(){this.stopRefreshTimer()}},oo=o(4982);const lo=(0,q.Z)(to,[["render",eo],["__scopeId","data-v-7cfeb776"]]);var ao=lo;z()(to,"components",{QPage:B.Z,QMarkupTable:oo.Z,QChip:Oe.Z,QAvatar:De.Z});const no={key:0,class:"absolute-center"},so=(0,m._)("div",{class:"text-overline"},"Please enter a valid token to connect to backend API",-1),ro={key:0,class:"text-red q-mt-md"},io={key:1,class:"absolute-center"};function co(e,t,o,a,n,s){const r=(0,m.up)("q-icon"),i=(0,m.up)("q-input"),c=(0,m.up)("q-toggle"),u=(0,m.up)("q-btn"),d=(0,m.up)("q-card-section"),p=(0,m.up)("q-card"),h=(0,m.up)("q-spinner-audio");return(0,m.wg)(),(0,m.iD)(m.HY,null,[n.tokenValidationInProgress?(0,m.kq)("",!0):((0,m.wg)(),(0,m.iD)("div",no,[(0,m.Wm)(p,{class:"my-card"},{default:(0,m.w5)((()=>[(0,m.Wm)(d,{class:"column"},{default:(0,m.w5)((()=>[so,(0,m.Wm)(i,{modelValue:n.token,"onUpdate:modelValue":t[1]||(t[1]=e=>n.token=e),outlined:"",type:n.isPwd?"password":"text",hint:"RAPO token",onKeyup:t[2]||(t[2]=(0,l.D2)((e=>s.connect(n.token)),["enter"])),autofocus:""},{append:(0,m.w5)((()=>[(0,m.Wm)(r,{name:n.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[0]||(t[0]=e=>n.isPwd=!n.isPwd)},null,8,["name"])])),_:1},8,["modelValue","type"]),(0,m.Wm)(c,{color:"teal",modelValue:n.rememberToken,"onUpdate:modelValue":t[3]||(t[3]=e=>n.rememberToken=e),label:"Remember token"},null,8,["modelValue"]),(0,m.Wm)(u,{color:"teal",label:"Connect",onClick:t[4]||(t[4]=e=>s.connect(n.token))}),n.connectError?((0,m.wg)(),(0,m.iD)("p",ro,"Error connecting. Check token and try again!")):(0,m.kq)("",!0)])),_:1})])),_:1})])),n.tokenValidationInProgress?((0,m.wg)(),(0,m.iD)("div",io,[(0,m.Wm)(h,{color:"teal",size:"10em"})])):(0,m.kq)("",!0)],64)}var uo={data(){return{token:"",isPwd:!0,rememberToken:!1,connectError:!1,tokenValidationInProgress:!1,$q:(0,v.Z)()}},methods:{...(0,k.nv)(["validateToken"]),async connect(e){this.tokenValidationInProgress=!0;const t=await this.validateToken(e);t?(this.rememberToken&&this.$q.cookies.set("rapo_token",e,{SameSite:"Strict",expires:"365d"}),this.$router.push("/")):(this.connectError=!0,this.$q.cookies.remove("rapo_token")),this.tokenValidationInProgress=!1}},computed:{...(0,k.Se)(["getTokenIsValid"])},mounted(){if(this.$q.cookies.has("rapo_token")){const e=this.$q.cookies.get("rapo_token");this.connect(e)}}},mo=o(3876);const po=(0,q.Z)(uo,[["render",co]]);var ho=po;z()(uo,"components",{QCard:ge.Z,QCardSection:fe.Z,QInput:U.Z,QIcon:W.Z,QToggle:be.Z,QBtn:D.Z,QSpinnerAudio:mo.Z});var _o={updateSearch(e,t){e.search=t},updateHideSearch(e,t){e.hideSearch=t},updateControlCatalogue(e,t){e.controlCatalogue=t},updateControlResults(e,t){e.controlResults=t},updateTokenValue(e,t){e.tokenValue=t,e.tokenIsValid=!!t}},go={updateControlCatalogue(e){i.Z.start(),fetch("/api/get-all-controls",{method:"GET",headers:{Authorization:`Bearer ${e.getters.getToken}`,"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json()})).then((function(t){e.commit("updateControlCatalogue",t),i.Z.stop()}))},updateControlResults(e,t){i.Z.start(),console.log("Call /api/get-control-runs with param:",t),fetch("/api/get-control-runs",{method:"GET",headers:{Authorization:`Bearer ${e.getters.getToken}`,"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json()})).then((function(t){e.commit("updateControlResults",t),i.Z.stop()}))},updateHideSearch(e,t){e.commit("updateHideSearch",t)},updateSearch(e,t){e.commit("updateSearch",t)},removeToken(e){e.commit("updateTokenValue","")},async validateToken(e,t){const o=await fetch("/api/help",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return o.ok?(e.commit("updateTokenValue",t),!0):(e.commit("updateTokenValue",""),!1)}},fo={getToken:e=>e.tokenValue,getTokenIsValid:e=>e.tokenIsValid,getSearch:e=>e.search,hideSearch:e=>e.hideSearch,controlCatalogue:e=>e.controlCatalogue,controlCatalogueLen:e=>e.controlCatalogue.length,controlCatalogueById:e=>t=>e.controlCatalogue.find((e=>e.control_id===Number(t))),filteredControlCatalogue:e=>{const t=e.search;var o=e.controlCatalogue;return t&&(o=o.filter((e=>e.control_name.toUpperCase().indexOf(t.toUpperCase())>-1||e.control_desc.toUpperCase().indexOf(t.toUpperCase())>-1))),o},controlResults:e=>e.controlResults,controlResultsLen:e=>e.controlResults.length,filteredControlResults:e=>{const t=e.search;var o=e.controlResults;return t&&(o=o.filter((e=>e.control_name.toUpperCase().indexOf(t.toUpperCase())>-1))),o}};const wo=(0,k.MT)({state(){return{search:"",hideSearch:!1,controlCatalogue:[],controlResults:[],tokenIsValid:!1,tokenValue:""}},mutations:_o,actions:go,getters:fo});var bo=wo;const yo=(0,Y.p7)({scrollBehavior:(e,t,o)=>o||(e.hash?{selector:e.hash}:{top:0}),history:(0,Y.PO)(),routes:[{path:"/",redirect:"/controls"},{name:"controls",path:"/controls",meta:{hideSearch:!1},component:Ae},{name:"results",path:"/results",meta:{hideSearch:!1},component:ao},{name:"edit-control",path:"/edit-control/:controlId",meta:{hideSearch:!0},component:Qt,props:!0},{name:"token",path:"/token",meta:{hideSearch:!0},component:ho},{path:"/:notfound(.*)",redirect:"/controls"}]});yo.beforeEach((function(e,t,o){bo.state.tokenIsValid||"token"===e.name?(e.meta.hideSearch?bo.state.hideSearch=!0:bo.state.hideSearch=!1,o()):o("/token")}));var ko=yo;const vo=(0,l.ri)(E);vo.use(a.Z,d),vo.use(ko),vo.use(bo),vo.mount("#app")}},t={};function o(l){var a=t[l];if(void 0!==a)return a.exports;var n=t[l]={exports:{}};return e[l].call(n.exports,n,n.exports,o),n.exports}o.m=e,function(){var e=[];o.O=function(t,l,a,n){if(!l){var s=1/0;for(u=0;u<e.length;u++){l=e[u][0],a=e[u][1],n=e[u][2];for(var r=!0,i=0;i<l.length;i++)(!1&n||s>=n)&&Object.keys(o.O).every((function(e){return o.O[e](l[i])}))?l.splice(i--,1):(r=!1,n<s&&(s=n));if(r){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[l,a,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var l in t)o.o(t,l)&&!o.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,l){var a,n,s=l[0],r=l[1],i=l[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(a in r)o.o(r,a)&&(o.m[a]=r[a]);if(i)var u=i(o)}for(t&&t(l);c<s.length;c++)n=s[c],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(u)},l=self["webpackChunkrapo_ui"]=self["webpackChunkrapo_ui"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=o.O(void 0,[998],(function(){return o(5675)}));l=o.O(l)})();
//# sourceMappingURL=app.b1f10251.js.map